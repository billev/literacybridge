<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml"
		 xmlns:waveform="org.literacybridge.authoring.views.waveform.*"
         width="100%" backgroundAlpha="0.5"
         borderStyle="solid" borderThickness="1" borderColor="#646464" fontSize="12"
         initialize="init()" xmlns:views="org.literacybridge.authoring.views.*">

	<mx:Script>
		<![CDATA[
			import mx.binding.utils.BindingUtils;
			import org.literacybridge.authoring.schema.ContentFile;
			import org.literacybridge.authoring.audio.AudioSpectrum;
			
			[Bindable]
			public var offset:int;
			
			public var file:ContentFile;
			[Bindable]
			public var waveFormState:WaveFormState = new WaveFormState();
			
			public function init():void {
				zoomSlider.minimum=128;
				zoomSlider.snapInterval=128;
				zoomSlider.maximum = 1024;
			}
			
			public function update():void {
				blocks.blocks = file.children;
				waveFormState.length = file.spectrum.audio.length;
				waveFormState.autoZoom(blocks.width);
				zoomSlider.value = waveFormState.interval;
				waveForm.spectrum=file.spectrum;
				hyper.spectrum = file.spectrum;
				hyper.hyperlinks = file.hyperlinks;
				player.init(file.spectrum.audio);
				position.init();
				draw();
			}
			
			private function draw():void {
				waveFormState.interval = zoomSlider.value;
				waveFormState.start = scrollBar.scrollPosition;
				waveFormState.end = waveFormState.start + blocks.width * waveFormState.interval;
				scrollBar.minScrollPosition = 0;
				scrollBar.maxScrollPosition = waveFormState.length - blocks.width * waveFormState.interval;

				
				blocks.draw();
				waveForm.draw();
				hyper.draw();				
			}
			
		]]>
	</mx:Script>
	<mx:VBox width="100%">
		<mx:HBox width="100%">
			<mx:Label text="Show:"/>
			<mx:CheckBox label="Blocks" selected="true" id="showBlocks"/>
			<mx:CheckBox label="Hyperlinks" selected="true" id="showHyperlinks"/>
			<mx:Spacer width="20"/>
			<mx:Label text="Zoom:"/>
			<mx:HSlider change="draw()" id="zoomSlider" liveDragging="true"/>
			<views:PlayerControl position="{position}" id="player"/>
		</mx:HBox>
		<mx:Canvas width="100%" height="60" borderStyle="solid">
			<waveform:WaveFormBackground width="100%" height="100%"/>
			<waveform:WaveFormVisualizer id="waveForm" width="100%" height="100%" waveFormState="{waveFormState}"/>
			<waveform:WaveFormBlocks id="blocks" width="100%" height="100%" visible="{showBlocks.selected}" waveFormState="{waveFormState}"/>
			<waveform:WaveFormHyperLinks id="hyper" width="100%" height="100%" visible="{showHyperlinks.selected}" waveFormState="{waveFormState}"/>
			<waveform:WaveFormPosition id="position" width="100%" height="100%" waveFormState="{waveFormState}" playerControl="{player}"/>
		</mx:Canvas>
		<mx:Spacer width="100%" height="10"/>
	 	<mx:HScrollBar id="scrollBar" width="100%" scrollPosition="{offset}" enabled="true" scroll="draw()"/>
	</mx:VBox>
</mx:Panel>
